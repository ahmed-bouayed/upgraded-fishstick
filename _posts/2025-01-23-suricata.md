---
title: suricata
description: description
published: false
date: 2025-01-23
categories: security
tags: ids ips network security monitoring
image:
  path: /assets/img/headers/suricata.webp
  lqip: data:image/webp;base64,UklGRpYAAABXRUJQVlA4IIoAAACQAwCdASoUAAoAPpE4l0eloyIhMAgAsBIJZACdAYrcpJm/tT9gAP77qmrKqNz3z8EBdrVNh/b0svDO9wroS+4ty8Yx3JMLAynj7VBSF8dm4N4Mn+5i5MR1qecTB62RREcFsQFL3M2tXbk+XEpMN5saLh+1Vf3Wx++k+ftP4Q1iUl+zuMpBtXMAAAA=
  alt: suricata
---


1. What is Suricata

Suricata is a high performance Network IDS, IPS and Network Security Monitoring engine. It is open source and owned by a community-run non-profit foundation, the Open Information Security Foundation (OISF). Suricata is developed by the OISF.

```bash
sudo add-apt-repository ppa:oisf/suricata-stable
sudo apt update
sudo apt install suricata
```

```bash
sudo suricata --build-info
sudo systemctl status suricata
```

First, determine the interface(s) and IP address(es) on which Suricata should be inspecting network packets:

```text
$ ip addr

2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
link/ether 00:11:22:33:44:55 brd ff:ff:ff:ff:ff:ff
inet 10.0.0.23/24 brd 10.23.0.255 scope global noprefixroute enp1s0
```

Use that information to configure Suricata:

```bash
sudo nano /etc/suricata/suricata.yaml
```

There are many possible configuration options, we focus on the setup of the `HOME_NET` variable and the network interface configuration. The `HOME_NET` variable should include, in most scenarios, the IP address of the monitored interface and all the local networks in use. The default already includes the RFC 1918 networks. In this example `10.0.0.23` is already included within `10.0.0.0/8`. If no other networks are used the other predefined values can be removed.

In this example the interface name is enp1s0 so the interface name in the af-packet section needs to match. An example interface config might look like this:

Capture settings:
```yaml
af-packet:
    - interface: enp1s0
      cluster-id: 99
      cluster-type: cluster_flow
      defrag: yes
      use-mmap: yes
      tpacket-v3: yes
```
This configuration uses the most recent recommended settings for the IDS runmode for basic setups. There are many of possible configuration options which are described in dedicated chapters and are especially relevant for high performance setups.
```text
      #Locate the line Community Flow ID and set the value of the variable community-id to true.
      # Community Flow ID
      # Adds a 'community_id' field to EVE records. These are meant to give
      # records a predictable flow ID that can be used to match records to
      # output of other tools such as Zeek (Bro).
      #
      # Takes a 'seed' that needs to be same across sensors and tools
      # to make the id less predictable.

      # enable/disable the community id feature.
      community-id: true
```




Signatures
Suricata uses Signatures to trigger alerts so it's necessary to install those and keep them updated. Signatures are also called rules, thus the name rule-files. With the tool suricata-update rules can be fetched, updated and managed to be provided for Suricata.

In this guide we just run the default mode which fetches the ET Open ruleset:
```bash
sudo suricata-update
```
Afterwards the rules are installed at /var/lib/suricata/rules which is also the default at the config and uses the sole suricata.rules file.

Running Suricata
With the rules installed, Suricata can run properly and thus we restart it:
```bash
sudo systemctl restart suricata
```
To make sure Suricata is running check the Suricata log:
```bash
sudo tail /var/log/suricata/suricata.log
```




Add Ruleset Providers
You can expand Suricata's rules by adding more providers. It can fetch rules from a variety of free and commercial providers.

You can list the default provider list by using the following command.
```bash
sudo suricata-update list-sources
```
For example, if you want to include the tgreen/hunting ruleset, you can enable it with the following command.
```bash
sudo suricata-update enable-source tgreen/hunting
```
Run the `suricata-update` command again to download and update the new rules. Suricata, by default, can process any rule changes without restarting.


To see what is available, fetch the master index from the OISF hosts:
```bash
sudo suricata-update update-sources
```
Then have a look at what is available:
```bash
sudo suricata-update list-sources
```

Each of the rulesets has a name that has a 'vendor' prefix, followed by a set name. For example, OISF's traffic id ruleset is called 'oisf/trafficid'.

To enable 'oisf/trafficid', enter:

```bash
sudo suricata-update enable-source oisf/trafficid
sudo suricata-update
```



Controlling which rules are used
By default suricata-update will merge all rules into a single file `/var/lib/suricata/rules/suricata.rules`.

To enable rules that are disabled by default, use `/etc/suricata/enable.conf`

```conf
2019401                   # enable signature with this sid
group:emerging-icmp.rules # enable this rulefile
re:trojan                 # enable all rules with this string
Similarly, to disable rules use /etc/suricata/disable.conf:

2019401                   # disable signature with this sid
group:emerging-info.rules # disable this rulefile
re:heartbleed             # disable all rules with this string
```

After updating these files, rerun suricata-update again:
```bash
sudo suricata-update
```
Finally restart Suricata.

```bash
sudo systemctl restart suricata
```


2. Check Logs for Alerts
Suricata logs alerts in the eve.json file (located in /var/log/suricata/ by default). Use tail to monitor the file for alerts:

```bash
sudo tail -f /var/log/suricata/eve.json
```

If Suricata detects any suspicious activity, it will log it here in JSON format.


Deploying Suricata as a Network Intrusion Detection System (NIDS) 
Enable Promiscuous Mode

Suricata needs to capture all packets, not just those addressed to the VM. Enable promiscuous mode on the VM’s network interface:


In the network interface settings, you’ll see an option for Promiscuous Mode.

```bash
ip link set eth0 promisc on
```



Verify Promiscuous Mode

Log into the VM and verify that promiscuous mode is enabled on the network interface:

```bash
ip link show eth0
```

Look for the PROMISC flag in the output. For example:
```text
2: eth0: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
```
The PROMISC flag indicates that promiscuous mode is active.




Step 1: Make Promiscuous Mode Persistent
To enable promiscuous mode permanently, you can use a systemd service or modify the network configuration.

Option 1: Using netplan (if your system uses netplan)
Edit your Netplan configuration file (usually located in /etc/netplan/):



sudo nano /etc/netplan/01-netcfg.yaml
Add the following lines under the appropriate network interface:

network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no
      addresses: [192.168.1.100/24]  # Replace with your static IP
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
      optional: true
      link-local: []
      match:
        macaddress: xx:xx:xx:xx:xx:xx  # Replace with your MAC address
      set-name: eth0
      routes:
        - to: 0.0.0.0/0
          via: 192.168.1.1
      # Add this line to enable promiscuous mode
      accept-all-mac-addresses: true
Save and apply the changes:



sudo netplan apply
Option 2: Using a systemd Service
Create a systemd service file:



sudo nano /etc/systemd/system/set-promisc.service
Add the following content:

[Unit]
Description=Set eth0 to promiscuous mode
After=network.target

[Service]
Type=oneshot
ExecStart=/usr/sbin/ip link set dev eth0 promisc on
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
Enable and start the service:



sudo systemctl enable set-promisc.service
sudo systemctl start set-promisc.service
Step 2: Make Interface Offloading Changes Persistent
To disable GRO (Generic Receive Offload) and LRO (Large Receive Offload) permanently, you can use a systemd service.

Create a systemd service file:



sudo nano /etc/systemd/system/disable-offloading.service
Add the following content:

[Unit]
Description=Disable GRO and LRO on eth0
After=network.target

[Service]
Type=oneshot
ExecStart=/usr/sbin/ethtool -K eth0 gro off lro off
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
Enable and start the service:



sudo systemctl enable disable-offloading.service
sudo systemctl start disable-offloading.service
Step 3: Verify Persistent Changes
Reboot your VM:



sudo reboot
After the reboot, verify the settings:

Check promiscuous mode:



ip addr show eth0
Look for the PROMISC flag.

Check offloading settings:



ethtool -k eth0 | grep receive-offload
Ensure generic-receive-offload and large-receive-offload are set to off.

Step 4: Test Snort
Run Snort in NIDS mode to ensure it works as expected:



sudo snort -A console -q -u snort -g snort -c /etc/snort/snort.conf -i eth0
